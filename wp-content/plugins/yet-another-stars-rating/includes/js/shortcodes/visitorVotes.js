(()=>{"use strict";const{__:t}=wp.i18n;function e(t,e,r,n,o,i,l,d,y,u,v,c){e=parseFloat(e),n=yasrTrueFalseStringConvertion(n);const g=document.getElementById(o),_=JSON.parse(yasrWindowVar.isUserLoggedIn);a(v,!1),yasrSetRaterValue(t,o,g,1,n,e,(function(t,e){a(v,!0);let n={action:"yasr_send_visitor_rating",rating:t,post_id:r,is_singular:d};!0===_&&Object.assign(n,{nonce_visitor:l}),this.setRating(t),this.disable(),jQuery.post(yasrWindowVar.ajaxurl,n).done((function(t){if(!1===(t=yasrValidJson(t)))return a(v,!1),void s(c,"<span>Not a valid Json Element, rating can't be saved.</span>");let r,n=`yasr-vote-${t.status}`;"success"===t.status&&(s(y,t.number_of_votes),s(u,t.average_rating)),r=`<span class="yasr-small-block-bold" id="${n}"> ${t.text} </span>`,s(c,r),a(v,!1),e()})).fail((function(t,e,s,a){console.error("YASR ajax call failed. Can't save data"),console.log(t)}))}))}function s(t,e){null!==t&&(t.innerHTML=e,t.style.display="")}function a(t,e=!0){let a="";!0===e&&(a=yasrWindowVar.loaderHtml),s(t,a)}function r(e){const s=e.medium_rating;delete e.medium_rating;let a=0;for(let t=1;t<=5;t++)(1===t||e[t].n_of_votes>a)&&(a=e[t].n_of_votes);let r=Math.log(a)*Math.LOG10E+1|0,n="5%";r<=3&&(n="5%"),r>3&&r<=5&&(n="10%"),r>5&&(n="15%");let o='<div class="yasr-visitors-stats-tooltip">';o+='<span id="yasr-medium-rating-tooltip">'+s+" "+t("out of 5 stars","yet-another-stars-rating")+"</span>",o+='<div class="yasr-progress-bars-container">';let i=t("stars","yet-another-stars-rating"),l=0,d=0;for(let s=5;s>0;s--)1===s&&(i=t("star","yet-another-stars-rating")),void 0!==e[s]&&(l=e[s].progressbar,d=e[s].n_of_votes),o+=`<div class='yasr-progress-bar-row-container yasr-w3-container'>\n                               <div class='yasr-progress-bar-name'>${s} ${i}</div> \n                               <div class='yasr-single-progress-bar-container'> \n                                   <div class='yasr-w3-border'> \n                                       <div class='yasr-w3-amber' style='height:17px;width:${l}'></div> \n                                   </div>\n                               </div> \n                               <div class='yasr-progress-bar-votes-count' style="flex-basis:${n} ">${d}</div>\n                           </div>`;return o+="</div></div>",o}!function(t){if(t.length>0&&(function(t){for(let r=0;r<t.length;r++)!function(r){if(!1!==t.item(r).classList.contains("yasr-star-rating"))return;const n=t.item(r),o=n.getAttribute("data-rater-postid"),i=n.id,l=i.replace("yasr-visitor-votes-rater-",""),d=document.getElementById("yasr_visitor_votes_"+l),y=parseInt(n.getAttribute("data-rater-starsize")),u=n.getAttribute("data-rater-nonce"),v=n.getAttribute("data-issingular"),c="yasr-vv-votes-number-container-"+l,g="yasr-vv-average-container-"+l,_="yasr-vv-bottom-container-"+l,m="yasr-vv-loader-"+l,f=document.getElementById(c),p=document.getElementById(g),b=document.getElementById(_),w=document.getElementById(m);let h=n.getAttribute("data-rating"),E=n.getAttribute("data-readonly-attribute"),x=n.getAttribute("data-rater-readonly");if(null===E&&(E=!1),E=yasrTrueFalseStringConvertion(E),x=yasrTrueFalseStringConvertion(x),!0===E&&(x=!0),"yes"===yasrWindowVar.ajaxEnabled){a(w);let t={action:"yasr_load_vv",post_id:o};jQuery.get(yasrWindowVar.ajaxurl,t).done((function(t){let r,n=yasrValidJson(t);if(!1===n){let t="Not a valid Json Element";return a(w,!1),void s(d,t)}if(r=!0===E||n.yasr_visitor_votes.stars_attributes.read_only,h=n.yasr_visitor_votes.number_of_votes>0?n.yasr_visitor_votes.sum_votes/n.yasr_visitor_votes.number_of_votes:0,h=h.toFixed(1),h=parseFloat(h),e(y,h,o,r,i,0,u,v,f,p,w,b),!0!==E&&(s(f,n.yasr_visitor_votes.number_of_votes),s(p,h),!1!==n.yasr_visitor_votes.stars_attributes.span_bottom)){let t=n.yasr_visitor_votes.stars_attributes.span_bottom;s(b,t)}})).fail((function(t,s,a,r){console.info("YASR ajax call failed. Showing ratings from html"),e(y,h,o,x,i,0,u,v,f,p,w,b),!0!==E&&(b.style.display="")}))}else e(y,h,o,x,i,0,u,v,f,p,w,b)}(r)}(t),"yes"===yasrWindowVar.visitorStatsEnabled)){let t=document.getElementsByClassName("yasr-dashicons-visitor-stats");t&&function(t){let e,s,a=!1;for(let n=0;n<t.length;n++)!function(n){let o="#"+t.item(n).id,i=t.item(n).getAttribute("data-postid");0===n&&(e=document.getElementsByClassName("yasr-vv-text-container"),null!==e&&(s=window.getComputedStyle(e[0],null).getPropertyValue("color"))),s&&(document.getElementById(t.item(n).id).style.fill=s);let l={action:"yasr_stats_visitors_votes",post_id:i};"function"==typeof tippy&&tippy(o,{allowHTML:!0,content:'<span style="color: #0a0a0a">Loading...</span>',theme:"yasr",arrow:!0,arrowType:"round",onShow:function(t){o!==a&&jQuery.post(yasrWindowVar.ajaxurl,l,(function(e){if(!1!==(e=yasrValidJson(e)))return"error"===e.status?(console.error(e.text),void t.setContent(e.text)):void t.setContent(r(e));t.setContent("Error!")})).fail((function(e,s,a,r){console.log(e),t.setContent("YASR ajax call failed.")}))},onHidden:function(){a=o}})}(n)}(t)}}(document.getElementsByClassName("yasr-rater-stars-vv"))})();